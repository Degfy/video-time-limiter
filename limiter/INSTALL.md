# 视频时长限制器 - 安装说明

## 功能介绍

视频时长限制器是一个Chrome浏览器扩展，用于：
- 📊 统计所有网页的视频观看时长
- ⏰ 设置每日观看时间限制
- 🚨 超过限制时显示醒目提示
- 💾 支持本地存储和远程服务器同步
- 🎯 自定义提示内容

## 安装步骤

### 1. 开发者模式安装（推荐）

1. **打开Chrome扩展管理页面**
   - 在Chrome地址栏输入：`chrome://extensions/`
   - 或者：菜单 → 更多工具 → 扩展程序

2. **启用开发者模式**
   - 在页面右上角打开"开发者模式"开关

3. **加载扩展**
   - 点击"加载已解压的扩展程序"
   - 选择 `limiter` 文件夹
   - 点击"选择文件夹"

4. **确认安装**
   - 扩展应该出现在扩展列表中
   - 确保扩展已启用（开关为蓝色）

### 2. 验证安装

1. **检查扩展图标**
   - Chrome工具栏应该显示扩展图标（时钟+播放按钮）
   - 如果没有显示，点击拼图图标固定扩展

2. **打开设置界面**
   - 点击扩展图标
   - 应该弹出设置界面

3. **测试功能**
   - 打开 `test.html` 文件进行功能测试
   - 或访问任何包含视频的网站

## 使用说明

### 基本设置

1. **点击扩展图标**打开设置界面

2. **选择存储模式**
   - 点击"本地模式"或"远程模式"按钮切换存储方式
   - **本地模式**：数据保存在浏览器本地，无需服务器
   - **远程模式**：数据同步到服务器，支持多设备共享

3. **配置时间限制**
   - 支持多种格式：`30m`、`1h30m`、`01:30:00`
   - 可使用预设按钮快速设置

4. **远程模式配置**（仅在远程模式下显示）
    - **服务器地址**：输入服务器API地址（如：http://localhost:8080）
    - **服务器状态检查**：点击"检查"按钮测试服务器连接状态
    - **用户ID管理**：查看、编辑、复制或重新生成用户ID
 
 5. **自定义提示内容**
    - 设置超时提醒的文字内容

### 远程模式配置

如果要使用远程服务器同步数据：

1. **启动服务器**
   ```bash
   cd ../server
   make run
   ```

2. **配置服务器地址**
   - 在扩展设置中输入：`http://localhost:8080`
   - 用户ID会自动生成，也可以手动复制分享

3. **数据同步**
   - 观看数据会自动同步到服务器
   - 时间限制设置也会同步

### 功能特性

- ✅ **自动检测视频**：支持所有HTML5视频元素
- ✅ **精确计时**：只在视频实际播放时计时
- ✅ **智能暂停**：切换标签页时自动暂停计时
- ✅ **跨天重置**：每天自动重置观看时间
- ✅ **重复提醒**：关闭提示后继续播放会再次提醒
- ✅ **数据持久化**：本地或远程存储，数据不丢失
- 🆕 **模式切换**：一键切换本地模式和远程模式
- 🆕 **服务器状态显示**：远程模式下实时显示服务器连接状态
- 🆕 **服务器状态检查**：手动检测远程服务器连接状态
- 🆕 **用户ID自定义**：支持手动设置和编辑用户ID
- 🆕 **智能界面**：根据模式自动显示/隐藏相关配置
- 🆕 **配置同步**：远程模式下自动同步自定义提示内容到服务器

## 测试功能

### 使用测试页面

1. **打开测试页面**
   - 在浏览器中打开 `test.html`
   - 或者双击文件直接打开

2. **设置短时间限制**
   - 建议设置30秒或1分钟便于测试

3. **播放测试视频**
   - 点击播放按钮开始测试
   - 观察扩展是否正常计时

4. **验证提醒功能**
   - 等待超过时间限制
   - 检查是否弹出提醒框

### 测试检查项

- [ ] 视频播放时开始计时
- [ ] 视频暂停时停止计时
- [ ] 切换标签页时暂停计时
- [ ] 超过限制时弹出警告
- [ ] 关闭警告后继续播放再次提醒
- [ ] 设置界面正常工作
- [ ] 数据持久化正常

## 常见问题

### Q: 扩展图标不显示？
A: 点击Chrome工具栏右侧的拼图图标，找到"视频时长限制器"并点击固定图标。

### Q: 视频检测不到？
A: 确保网页使用HTML5 `<video>` 标签。某些视频播放器可能使用Flash或其他技术。

### Q: 时间统计不准确？
A: 检查是否有多个视频同时播放，扩展会统计所有视频的播放时间。

### Q: 设置保存失败？
A: 检查输入格式是否正确，特别是时间格式和服务器地址格式。

### Q: 远程模式连接失败？
A: 确保服务器正在运行，地址格式正确（如：`http://localhost:8080`）。可以使用"检查"按钮测试服务器状态。

### Q: 服务器状态检查显示"部分可用"？
A: 这表示API可以访问但健康检查接口失败，通常不影响正常使用，但建议检查服务器配置。

### Q: 如何设置自定义用户ID？
A: 点击用户ID旁边的"编辑"按钮，输入自定义ID后按回车或点击其他地方保存。

### Q: 用户ID有什么要求？
A: 用户ID可以是任意非空字符串，建议使用有意义且唯一的标识符。

### Q: 本地模式和远程模式有什么区别？
A: 本地模式数据仅保存在当前浏览器，远程模式可以跨设备同步数据。切换模式时会自动显示/隐藏相关配置。

### Q: 切换到本地模式后数据会丢失吗？
A: 不会。本地数据会保留，只是不再与服务器同步。切换回远程模式时可以重新同步。

## 卸载扩展

1. 打开 `chrome://extensions/`
2. 找到"视频时长限制器"
3. 点击"移除"按钮
4. 确认卸载

## 技术支持

如果遇到问题：
1. 检查Chrome控制台是否有错误信息
2. 确认Chrome版本支持Manifest V3
3. 尝试重新加载扩展
4. 查看 `README.md` 了解更多技术细节

---

**注意**：此扩展仅用于个人时间管理，不会收集或上传任何个人隐私信息。